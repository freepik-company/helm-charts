# pipeline-launcher

Chart to install Pipeline Launcher engine

![Version: 1.5.0](https://img.shields.io/badge/Version-1.5.0-informational?style=flat-square) ![Type: application](https://img.shields.io/badge/Type-application-informational?style=flat-square)

## Values

| Key | Type | Default | Description |
|-----|------|---------|-------------|
| fullnameOverride | string | `""` | Completely replace the name of the generated name composed of release and chart name |
| gitCloneDaysAgo | int | `1` | Number of days to make a shallow clone of the repository. This only clones the commits between the number of days ago from now to the last one. |
| gitCredentials | object | `{}` | A .ssh directory with private key, known_hosts, config, etc. Used to authenticate with the git remote when performing the clone. Binding a Secret to this volume is  strongly recommended over other volume types. Also it can contain a .gitconfig and  .git-credentials file. No authentication is the default. Example `gitCredentials.secret.secretName: git-credentials` |
| listeners | list | `[]` |  |
| nameOverride | string | `""` | Replace the chart name of the file Chart.yaml in the generated name release-name-chart-name |
| namespaceResource | string | `"apiVersion: v1\nkind: Namespace\nmetadata:\n  name: ${NAME}"` | Default namespace resource to create if createNamespace variable is set to true in pipeline file Template variable called `${NAME}` is replaced with the name of the namespace given in the pipeline file |
| nodeSelector | object | `{}` | Node selector configuration to set the pod of the pipeline launcher instance [nodeSelector](https://kubernetes.io/docs/concepts/scheduling-eviction/assign-pod-node/#nodeselector) |
| pipelineGeneratorChart | string | `"europe-west1-docker.pkg.dev/fc-tekton/charts/pipeline-generator"` | Helm Chart package of pipeline-generator stored in a container registry with OCI support |
| pipelineGeneratorGCPAuthentication | bool | `true` | If the package is stored in the Artifact Registry of GCP this allows us to enable the authentication with it |
| sendmailBody | string | `"$(params.author), the initial step to start the pipeline of the application\n'$(params.project)' in the repository '$(params.repository)' has failed.\n\nCurrent branch is '$(params.branch)' with commit '$(params.commit)'.\n"` | Mail body |
| sendmailSecret | string | `"sendmail-secret"` | Secret name to authenticate sendmail task. |
| sendmailSender | string | `"launcher@example.com"` | Mail sender |
| sendmailSubject | string | `"Pipeline of project '$(params.project)' failed!"` | Mail subject |
| serviceAccount.annotations | object | `{}` | Annotations to add to the service account |
| serviceAccount.create | bool | `true` | Specifies whether a service account should be created |
| serviceAccount.name | string | `""` | The name of the service account to use. If not set and create is true, a name is generated using the fullname template |
| serviceAccountResource | string | `"apiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: ${NAME}\n  namespace: ${NAME}"` | Default serviceAccount resource to create if createNamespace variable is set to true in pipeline file Template variable called `${NAME}` is replaced with the name of the namespace given in the pipeline file. This service account will have the name of the namespace where is going to be placed. |
| tasksImage | string | `"europe-west1-docker.pkg.dev/fc-tekton/containers/gcloud-kubectl-helm-tkn@sha256:9b099394ce09adee91dc161ceafb2046f3c170e4eda304c8126df08282954567"` | Docker image with all the launcher needs to run new pipelines. That is gcloud, kubectl, helm and tkn (command line application of Tekton) |
| tolerations | list | `[]` | Pod tolerations to run the pipelines launcher instances [tolerations](https://kubernetes.io/docs/concepts/scheduling-eviction/taint-and-toleration/) |
| workspaceData | object | `{"emptyDir":{}}` | Tekton workspace configuration.  By default no workspace is used, but if so an emptyDir type is the default.  More info in [Workspaces](https://tekton.dev/docs/pipelines/pipelineruns/#specifying-workspaces) |

----------------------------------------------
Autogenerated from chart metadata using [helm-docs v1.11.0](https://github.com/norwoodj/helm-docs/releases/v1.11.0)

## Examples

- Sendmail Secret example:

```yaml
kind: Secret
apiVersion: v1
metadata:
  name: server-secret
stringData:
  url: "smtp.server.com"
  port: "25"
  user: "userid"
  password: "password"
  tls: "False"
```

- Listener configuration example:

```yaml
listeners:
  - name: pullrequest
    interceptors:
    - ref:
        name: "cel"
      params:
      - name: "filter"
        value: "header.match('X-Event-Key', 'pullrequest:created') || header.match('X-Event-Key', 'pullrequest:updated')"
      - name: "overlays"
        value:
        - key: X-Hub-Signature
          expression: "1234567"
        - key: truncated_sha
          expression: "body.pullrequest.source.commit.hash.truncate(7)"
    bindings:
      type: pull_requests
      project: $(body.repository.name)
      repository: git@bitbucket.org:$(body.repository.full_name).git
      branch: $(body.pullrequest.source.branch.name)
      pipeline: $(body.pullrequest.source.branch.name)
      commit: $(body.pullrequest.source.commit.hash)
      shortCommit: $(extensions.truncated_sha)
      author: $(body.pullrequest.author.display_name)
      email: N/A
  - name: push
    interceptors:
    - ref:
        name: "cel"
      params:
      - name: "filter"
        value: "header.match('X-Event-Key', 'repo:push') && body.push.changes.exists(x, x.new.type == 'branch') && ! body.push.changes.exists(x, x.new.type == 'tag')"
      - name: "overlays"
        value:
        - key: X-Hub-Signature
          expression: "1234567"
        - key: truncated_sha
          expression: "body.push.changes[0].new.target.hash.truncate(7)"
        - key: author
          expression: "body.push.changes[0].new.target.author.raw.split(' <')[0]"
        - key: email
          expression: "body.push.changes[0].new.target.author.raw.split('<')[1].replace('>', '')"
    bindings:
      type: branches
      project: $(body.repository.name)
      repository: git@bitbucket.org:$(body.repository.full_name).git
      branch: $(body.push.changes[0].new.name)
      pipeline: $(body.push.changes[0].new.name)
      commit: $(body.push.changes[0].new.target.hash)
      shortCommit: $(extensions.truncated_sha)
      author: $(extensions.author)
      email: $(extensions.email)
  - name: tag
    interceptors:
    - ref:
        name: "cel"
      params:
      - name: "filter"
        value: "header.match('X-Event-Key', 'repo:push') && body.push.changes.exists(x, x.new.type == 'branch') && body.push.changes.exists(x, x.new.type == 'tag')"
      - name: "overlays"
        value:
        - key: X-Hub-Signature
          expression: "1234567"
        - key: truncated_sha
          expression: "body.push.changes[0].new.target.hash.truncate(7)"
        - key: author
          expression: "body.push.changes[0].new.target.author.raw.split(' <')[0]"
        - key: email
          expression: "body.push.changes[0].new.target.author.raw.split('<')[1].replace('>', '')"
    bindings:
      type: tags
      project: $(body.repository.name)
      repository: git@bitbucket.org:$(body.repository.full_name).git
      branch: $(body.push.changes[0].new.name)
      pipeline: $(body.push.changes[1].new.name)
      commit: $(body.push.changes[0].new.target.hash)
      shortCommit: $(extensions.truncated_sha)
      author: $(extensions.author)
      email: $(extensions.email)
```

## Inherited params

Next parameters are inherited to a running pipeline to use there in precoded and custom tasks:

- *params.type*: Type of pipelines launched. It could be `branches`, `pullrequests`, `tags` and `custom`
- *params.project*: Name of the project
- *params.repository*: Repository URL
- *params.branch*: Branch name
- *params.pipeline*: Pipeline name use for the pipeline regular expression
- *params.commit*: Commit hash
- *params.shortCommit*: Commit hash shorted
- *params.author*: Author name of the commit if present
- *params.email*: Email of the author's commit if present
